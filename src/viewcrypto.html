<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Monitor - Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Select2 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
    <!-- Custom CSS -->
    <style>
        /* General Styles */
      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
      
      body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #f0f4ff, #c8daf5);
        color: #333;
        display: flex;
        flex-direction: column; 
        overflow-x: hidden;
      }
      
      main {
          flex: 1; /* Allow the main content to expand and take up available space */
          overflow: auto;
        }
      
      
        .header {
          background-color: #0078d4;
          color: white;
          padding: 15px 20px; /* Space inside the header */
          display: flex;
          justify-content: space-between;
          align-items: center;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
          width: 100%; /* Full-width header */
          box-sizing: border-box; /* Includes padding in total width */
      }
      
      .header .container {
          width: 100%;
          max-width: 1200px; /* Restrict the content to a manageable width */
          margin: 0 auto; /* Center the content inside the header */
          display: flex;
          justify-content: space-between;
          align-items: center;
      }
        
      .header .logo h1 {
          font-size: 1.8rem;
          margin: 0;
          letter-spacing: 1px;
      }
        
      .header .logo span {
          color: #fca311;
      }
      
      
      .nav-links {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        gap: 20px;
      }
      
      .nav-links a {
        text-decoration: none;
        color: white;
        font-weight: bold;
        transition: color 0.3s;
      }
      
      .nav-links a:hover {
        color: #fca311;
      }
      
      .hero {
        text-align: center;
        margin: 20px auto;
        width: 97%;
        padding: 40px 20px;
        background: linear-gradient(135deg, #0078d4, #00509e);
        color: white;
        border-radius: 20px;
        margin-bottom: 30px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Optional: Subtle shadow for depth */
        box-sizing: border-box; 
      }
      
      h2 {
        font-size: 2.5rem;
      }
      
      .subtitle {
        font-style: italic;
        color: #d4e9ff;
      }
      
      .role-specific-content {
        display: flex;
        justify-content: center; /* Ensure the content is centered */
        gap: 20px;
        flex-wrap: wrap;
        padding: 0 20px; /* Optional: Add some padding for better alignment */
      }
      
      #manager-view {
        display: flex;  
        flex-wrap: wrap;
        gap: 20px;  /* Consistent gap between both rows and columns */
        justify-content: center; /* Center the cards horizontally */
        width: 100%; /* Make sure the container is full width */
        margin: 0 auto; /* Center the content */
      }
      
      .card {
        background: white;
        margin: 0; /* Remove the margin for consistency */
        border-radius: 20px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        padding: 20px;
        width: 100%; /* Ensure a consistent card width */
        text-align: center;
        transition: transform 0.3s, box-shadow 0.3s;
      }
      
      .card:hover {
        transform: translateY(-10px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      }
      
      .card .icon {
        font-size: 3rem;
        color: #0078d4;
        margin-bottom: 15px;
      }
      
      .card h4 {
        font-size: 1.5rem;
        margin-bottom: 10px;
      }
      
      .card p {
        color: #666;
        margin-bottom: 20px;
      }
      
      .card button {
        background-color: #0078d4;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
      }
      
      .card button:hover {
        transform: scale(1.05);
      }
      
      .card-row {
          display: flex;
          justify-content: space-between; /* Ensures even spacing */
          gap: 25px; /* Adds consistent gap between cards */
      }
      
      
      
      .delivery-completed {
        background-color: #28a745;
        color: white;
        padding: 12px 20px;
        border-radius: 5px;
        font-size: 1rem;
        border: none;
        cursor: pointer;
        transition: transform 0.3s;
      }
      
      .delivery-completed:hover {
        transform: translateY(-3px);
        background-color: #218838;
      }
      
    
      
        .btn-primary:hover {
          background-color: #05e31b;
          color: black;
          border-color: #05c902;
        }
      
        .btn-warning:hover {
          background-color: orange;
          color: black;
          border-color: yellow
        }
      
        .btn-danger:hover {
          background-color: red;
          color: black;
          border-color: #ff2323;
        }
      
        
        .card-footer .btn {
          flex: 1;
          margin: 0 0.25rem;
        }
        
        .row {
          margin-left: 0;
          margin-right: 0;
        }
        
        
        
      
        .footer {
          background-color: black;
          width: 100%;
          color: white;
          text-align: center;
          padding: 15px;
          font-size: 0.9rem;
          margin-top: 40px; /* Adjust the value to your liking */
          margin-bottom: 0;
        }
        
      .footer p {
        margin: 0 0;
      }
      
      /* Responsive Design */
      @media (max-width: 768px) {
        .card {
          width: 100%; 
        }
      
        .hero {
          padding: 20px;
        }
      
        .header {
          flex-wrap: wrap;
          text-align: center;
        }
      
        .nav-links {
          gap: 10px;
          justify-content: center;
        }
      
        .patient-card {
          width: 100%; /* Full width for smaller screens */
        }
      }
      
      </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
          <div class="logo">
            <h1>Crypto<span>Monitor</span></h1>
          </div>
          <nav>
            <ul class="nav-links">
              <li><a href="/dashboard">Dashboard</a></li>
              <li><a href="#">About</a></li>
              <li><a href="#">Contact</a></li>
              <li><a href="#">Sign Out</a></li>
            </ul>
          </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container py-5">
        <h2 class="mb-4">Crypto Dashboard</h2>
        <hr>

        <!-- Check Prices Section -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Check Cryptocurrency Prices</h5>
            </div>
            <div class="card-body">
                <form id="priceForm">
                    <div class="mb-3">
                        <label for="cryptos" class="form-label">Cryptocurrency</label>
                        <select id="cryptos" class="form-select" required>
                            <option value="" disabled selected>Select a cryptocurrency...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="currency" class="form-label">Currency</label>
                        <select id="currency" class="form-select" required>
                            <option value="" disabled selected>Select a currency...</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Get Prices</button>
                </form>
                <div id="priceResults" class="mt-4"></div>
            </div>
        </div>

        <div id="modal" class="modal hidden">
            <div class="modal-content">
              <span id="closeModal" class="close">&times;</span>
              <form id="cardForm">
                <label for="cryptocurrency">Cryptocurrency:</label>
                <input type="text" id="cryptocurrency" required>
        
                <label for="currency">Currency:</label>
                <input type="text" id="currency" required>
        
                <button type="submit">Add Card</button>
              </form>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 CryptoMonitor | All rights reserved.</p>
    </footer>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
    $(document).ready(() => {
        let selectedCrypto = null;
        let selectedCurrency = null;
        let countdown = 10; // Set initial countdown value (in seconds)
        let intervalId;
    
        // Initialize Select2 for both dropdowns
        $('#cryptos').select2({
            placeholder: "Select a cryptocurrency...",
            allowClear: true
        });
    
        $('#currency').select2({
            placeholder: "Select a currency...",
            allowClear: true
        });
    
        // Fetch all cryptocurrencies and populate dropdown
        async function populateCryptos() {
            try {
                const res = await fetch("https://api.coingecko.com/api/v3/coins/list");
                const data = await res.json();
    
                const dropdown = document.getElementById("cryptos");
                dropdown.innerHTML = '<option value="" disabled selected>Select a cryptocurrency...</option>';
    
                data.forEach(crypto => {
                    const option = document.createElement("option");
                    option.value = crypto.id; // Use the unique ID (e.g., bitcoin)
                    option.text = crypto.name; // Use the human-readable name (e.g., Bitcoin)
                    dropdown.appendChild(option);
                });
            } catch (error) {
                console.error("Error fetching cryptocurrencies:", error);
            }
        }
    
        // Fetch supported currencies and populate dropdown
        async function populateCurrency() {
            const dropdown = document.getElementById("currency");
            try {
                dropdown.innerHTML = '<option value="" disabled>Loading...</option>';
    
                const res = await fetch("https://api.coingecko.com/api/v3/simple/supported_vs_currencies");
                const data = await res.json();
    
                dropdown.innerHTML = '<option value="" disabled selected>Select a currency...</option>';
                data.forEach(currency => {
                    const option = document.createElement("option");
                    option.value = currency;
                    option.textContent = currency.toUpperCase();
                    dropdown.appendChild(option);
                });
            } catch (error) {
                console.error("Error fetching currencies:", error);
                dropdown.innerHTML = '<option value="" disabled>Error loading currencies</option>';
            }
        }
    
        // Call populateCryptos and populateCurrency on page load
        populateCryptos();
        populateCurrency();

        let cache = {}; // In-memory cache
        const CACHE_EXPIRY = 300000; 
    
        // Update selected values when dropdowns change
        $('#cryptos').on('change', function () {
            selectedCrypto = $(this).val();
            resetTimer();
            updatePrice(); // Immediately fetch price for new selection
        });
    
        $('#currency').on('change', function () {
            selectedCurrency = $(this).val();
            resetTimer();
            updatePrice(); // Immediately fetch price for new selection
        });

        $('#priceForm').on('submit', async (event) => {
        event.preventDefault();

        const cryptoId = $('#cryptos').val();
        const currency = $('#currency').val();

        if (!cryptoId || !currency) {
            alert('Please select a cryptocurrency and a currency.');
            return;
        }

        const cacheKey = `${cryptoId}_${currency}`;
        const currentTime = Date.now();

        // Check cache for valid data
        if (cache[cacheKey] && (currentTime - cache[cacheKey].timestamp < CACHE_EXPIRY)) {
            displayPrice(cache[cacheKey].price, currency, true);
        } else {
            try {
                const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${cryptoId}&vs_currencies=${currency}`);
                if (!response.ok) throw new Error('API unavailable');

                const data = await response.json();
                const price = data[cryptoId]?.[currency];

                if (price) {
                    cache[cacheKey] = { price, timestamp: currentTime }; // Update cache
                    displayPrice(price, currency, false);
                } else {
                    alert('Price data not available.');
                }
            } catch (error) {
                console.warn('API error. Attempting to use cached data:', error);

                if (cache[cacheKey]) {
                    displayPrice(cache[cacheKey].price, currency, true);
                } else {
                    alert('Failed to retrieve price data from API or cache.');
                }
            }
        }
    });

    function displayPrice(price, currency, fromCache) {
        $('#priceResults').html(`
        <div class="alert alert-info">
            <p>Price:<strong> ${price} ${currency} </strong></p>
            <p>Source: ${fromCache ? 'Cache' : 'API'}</p>
            </div>
            <div class="text-muted">Updating in <span id="timer">${countdown}</span> seconds...</div>
        `);
    }
    
        // Fetch and display price
        async function updatePrice() {
            if (!selectedCrypto || !selectedCurrency) {
                return; // Do nothing if both values are not selected
            }
            try {
                const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${selectedCrypto}&vs_currencies=${selectedCurrency}`);
                const data = await res.json();
                const priceResults = document.getElementById("priceResults");
                if (!data[selectedCrypto] || !data[selectedCrypto][selectedCurrency]) {
                    priceResults.innerHTML = '<div class="alert alert-warning">No price data available.</div>';
                } else {
                    const price = data[selectedCrypto][selectedCurrency];
                    priceResults.innerHTML = `
                    <div class="alert alert-info">
                        The price of <strong>${cryptos}</strong> in <strong>${currency.toUpperCase()}</strong> is <strong>${price.toLocaleString(undefined, { minimumFractionDigits: 4, maximumFractionDigits: 8 })}</strong>.
                    </div>
                    <div class="text-muted">Updating in <span id="timer">${countdown}</span> seconds...</div>
                `;
                }
            } catch (error) {
            }
        }
    
        // Reset the countdown timer
        function resetTimer() {
            clearInterval(intervalId); // Clear any existing interval
            countdown = 10; // Reset the countdown value
            startTimer();
        }
    
        // Start the countdown timer and update prices periodically
        function startTimer() {
            intervalId = setInterval(() => {
                countdown--;
                document.getElementById("timer").textContent = countdown;
    
                if (countdown <= 0) {
                    updatePrice(); // Fetch new price when timer reaches 0
                    countdown = 10; // Reset countdown
                }
            }, 1000); // Update every second
        }
    
        // Initialize the timer when the page loads
        startTimer();
    });
</script>    
    
    
</body>
</html>
